{% if section.settings.product != blank %}
  {% assign product = section.settings.product %}
{% endif %}

{% if product.id == 9211665187053 %}
  <section class="box-builder-section">
    <div class="page-width">
      <form
        action="/cart/add"
        method="post"
        class="box-builder-form"
        data-box-builder
      >
        <!-- REQUIRED VARIANT ID -->
        <input
          type="hidden"
          name="id"
          value="{{ product.selected_or_first_available_variant.id }}"
        >

        <h2>Build Your Box of 6</h2>
        <p>Select exactly 6 cookies.</p>

        {% assign flavours = 'Milk Chocolate Sea Salt,Oatmeal Raisin,Morning Roast,White Chocolate Macadamia Nut,Double Chocolate,Peanut Butter'
          | split: ','
        %}

        {% for flavour in flavours %}
          <div class="cookie-row">
            <label>{{ flavour }}</label>
            <select
              name="properties[{{ flavour | strip }}]"
              class="cookie-qty"
            >
              {% for i in (0..6) %}
                <option value="{{ i }}">{{ i }}</option>
              {% endfor %}
            </select>
          </div>
        {% endfor %}

        <p class="cookie-total">
          Total selected:
          <strong><span class="cookieTotal">0</span>/6</strong>
        </p>

        <p class="cookieError" style="display:none; color:red;">Please select exactly 6 cookies.</p>

        <button
          type="submit"
          class="button button--primary"
          disabled
        >
          Add Box of 6 to Cart
        </button>
      </form>
    </div>
  </section>

  <style>
    .box-builder-form {
      max-width: 480px;
      margin: 0 auto;
      padding: 2rem;
      border: 1px solid #e5e5e5;
      border-radius: 12px;
    }

    .cookie-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.75rem;
    }

    .cookie-row label {
      font-weight: 500;
    }

    .cookie-row select {
      width: 70px;
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('[data-box-builder]').forEach((form) => {
        const qtySelectors = form.querySelectorAll('.cookie-qty');
        const totalDisplay = form.querySelector('.cookieTotal');
        const errorMsg = form.querySelector('.cookieError');
        const submitBtn = form.querySelector('button[type="submit"]');

        function updateTotal() {
          let total = 0;
          qtySelectors.forEach((select) => {
            total += parseInt(select.value || 0);
          });

          totalDisplay.textContent = total;

          if (total === 6) {
            errorMsg.style.display = 'none';
            submitBtn.disabled = false;
          } else {
            errorMsg.style.display = 'block';
            submitBtn.disabled = true;
          }
        }

        qtySelectors.forEach((select) => {
          select.addEventListener('change', updateTotal);
        });

        updateTotal();
      });
    });
  </script>
{% endif %}

{% schema %}
{
  "name": "Box of 6 Builder",
  "settings": [
    {
      "type": "product",
      "id": "product",
      "label": "Box of 6 product"
    }
  ],
  "presets": [
    {
      "name": "Box of 6 Builder"
    }
  ]
}
{% endschema %}
